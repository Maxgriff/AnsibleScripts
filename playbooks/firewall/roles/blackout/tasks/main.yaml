# Do a network blackout on linux

- name: Do stuff on Linux
  block:
  - name: gather linux packages
    ansible.builtin.package_facts:
      manager: auto
      strategy: first

  - name: Use Firewalld
    when: '"firewalld" in ansible_facts.packages'
    import_tasks: firewalld.yaml

  - name: Do stuff with iptables
    when: '"iptables" in ansible_facts.packages'
    import_tasks: iptables.yaml

  when: ansible_system | lower == "linux"

- name: do stuff in windows
  when: ansible_system | lower == "windows"
  block: 
  - name: Allow team IPs into windows
    community.windows.win_firewall_rule:
      description: "Allow team machines into local machine"
      remoteip: "{{ item }}"
    loop: "{{ team_ips }}"

  - name: Add default drop rule
    community.windows.win_firewall:
      profiles:
      - "Domain"
      - "Private"
      - "Public"
      state: "enabled"
      inbound_action: "block"
